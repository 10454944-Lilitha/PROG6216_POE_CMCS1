@model CMCS1.Models.ViewModels.ClaimViewModel
@{
    ViewData["Title"] = "Submit Claim";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2 style="color: #2c3e50; text-align: center;">Submit Your Claim</h2>
<form asp-action="SubmitClaim" method="post" enctype="multipart/form-data" class="bg-light p-4 rounded shadow-sm" style="max-width: 600px; margin: 0 auto;">
    <div class="form-group">
        <label asp-for="HoursWorked" class="font-weight-bold text-dark">Hours Worked</label>
        <input asp-for="HoursWorked" class="form-control border-primary" type="number" min="1" max="1000" required />
        <span asp-validation-for="HoursWorked" class="text-danger"></span>
    </div>
    <div class="form-group">
        <label asp-for="HourlyRate" class="font-weight-bold text-dark">Hourly Rate</label>
        <input asp-for="HourlyRate" class="form-control border-primary bg-light" type="number" step="0.01" readonly />
        <small class="form-text text-muted">Your hourly rate is automatically set by HR and cannot be changed.</small>
        <span asp-validation-for="HourlyRate" class="text-danger"></span>
    </div>
    <div class="alert alert-info mt-3" role="alert">
        <strong>Total Claim Amount: </strong>
        <span id="totalAmount" style="font-size: 1.3em; color: #27ae60; font-weight: bold;">$0.00</span>
    </div>
    <div class="form-group">
        <label asp-for="Notes" class="font-weight-bold text-dark">Additional Notes</label>
        <textarea asp-for="Notes" class="form-control border-primary" rows="3" maxlength="500"></textarea>
        <span asp-validation-for="Notes" class="text-danger"></span>
    </div>
    <div class="form-group">
        <label asp-for="SupportingDocuments" class="font-weight-bold text-dark">Upload Documents</label>
        <input type="file" name="SupportingDocuments" class="form-control border-primary" multiple accept=".pdf,.docx,.xlsx" />
        @if (Model.UploadedFileNames?.Any() ?? false)
        {
            <ul class="list-group mt-2">
                @foreach (var file in Model.UploadedFileNames)
                {
                    <li class="list-group-item">@file</li>
                }
            </ul>
        }
    </div>
    <button type="submit" class="btn btn-primary btn-lg mt-3 w-100" style="background-color: #27ae60; border: none; font-size: 1.2em;">Submit</button>
    @if (!ViewData.ModelState.IsValid)
    {
        <div class="alert alert-danger mt-3" role="alert">
            Please correct the following errors:
            <ul>
                @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
                {
                    <li>@error.ErrorMessage</li>
                }
            </ul>
        </div>
    }
</form>
@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        function calculateTotal() {
            var hours = parseFloat(document.getElementById('HoursWorked').value) || 0;
            var rate = parseFloat(document.getElementById('HourlyRate').value) || 0;
            var total = hours * rate;
            document.getElementById('totalAmount').textContent = '$' + total.toFixed(2);
        }

        document.getElementById('HoursWorked').addEventListener('input', calculateTotal);
        document.getElementById('HourlyRate').addEventListener('input', calculateTotal);
        
        // Calculate on page load if values exist
        window.addEventListener('load', calculateTotal);
    </script>
}